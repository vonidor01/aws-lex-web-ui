<!-- LexWebUi loader -->
<script src="./chatbot-ui-loader.js"></script>
<script>
  var lexWebUiLoader = new LexWebUiLoader();

  getCoordinates()
    .then(
      function onCoordinatesResolved(coords) {
        console.info('coordinates', coords);
        return coords;
      },
      function onCoordinatesRejected(err) {
        console.warn('failed to obtain coordinates - ', err);
        return { lat: null, long: null };
      }
    )
    .then(function loadLexWebUi(coords) {
      // you may need to merge the lex config here
      lexWebUiLoader.load({
        lex: {
          botName: 'WebUiFullOhElevenOhOrderFlowers',
          sessionAttributes: {
            coords: JSON.stringify(coords)
          }
        }
      });
    })
    .catch(function (err) {
      console.error('error: ', err);
    });

  function getCoordinates() {
    return new Promise(function (resolve, reject) {
      if (!('geolocation' in navigator) ||
        !('getCurrentPosition' in navigator.geolocation)
      ) {
        return Promise.reject(
          new Error('geolocation API not available')
        );
      }
      var options = {
        timeout: 10000
      }

      // browser prompts for permission
      navigator.geolocation.getCurrentPosition(
        getPositionCallBack,
        reject,
        options
      );

      function getPositionCallBack(position) {
        var coords = '';
        try {
          coords = {
            lat: position.coords.latitude,
            long: position.coords.longitude
          };
        } catch (err) {
          return reject(err);
        }
        return resolve(coords);
      }
    });
  }
</script>
